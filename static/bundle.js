!function e(t,a,n){function s(l,c){if(!a[l]){if(!t[l]){var i="function"==typeof require&&require;if(!c&&i)return i(l,!0);if(r)return r(l,!0);var o=new Error("Cannot find module '"+l+"'");throw o.code="MODULE_NOT_FOUND",o}var p=a[l]={exports:{}};t[l][0].call(p.exports,function(e){var a=t[l][1][e];return s(a?a:e)},p,p.exports,e,t,a,n)}return a[l].exports}for(var r="function"==typeof require&&require,l=0;l<n.length;l++)s(n[l]);return s}({1:[function(e,t,a){var n=e("./events.js"),s=e("./helpers.js"),r=e("./summary_table.jsx"),l=React.createClass({displayName:"DeployPlan",loadingSub:null,loadingDoneSub:null,getInitialState:function(){return{loading_changes:!1,deploy_disabled:!1,deployHover:!1}},componentDidMount:function(){var e=this;this.loadingSub=n.subscribe("change_loading",function(){e.setState({loading_changes:!0})}),this.loadingDoneSub=n.subscribe("change_loading/done",function(){e.setState({loading_changes:!1})})},deployHandler:function(e){e.preventDefault(),this.setState({deploy_disabled:!0}),Q($.ajax({type:"POST",dataType:"json",url:this.props.context.envUrl+"/start-deploy",data:{strategy:this.props.summary,SecurityID:this.props.summary.SecurityID}})).then(function(e){window.location=e.url},function(e){console.error(e)})},mouseEnterHandler:function(e){this.setState({deployHover:!0})},mouseLeaveHandler:function(e){this.setState({deployHover:!1})},canDeploy:function(){return"success"===this.props.summary.validationCode||"warning"===this.props.summary.validationCode},isEmpty:function(e){for(var t in e)if(e.hasOwnProperty(t)&&e[t])return!1;return!0},showNoChangesMessage:function(){var e=this.props.summary;return e.initialState===!0?!1:"undefined"===e.messages?!0:this.isEmpty(e.changes)&&0===e.messages.length},actionTitle:function(){var e=this.props.summary.actionTitle;return"undefined"==typeof e||""===e?"Make a selection":this.props.summary.actionTitle},render:function(){var e=this.props.summary.messages;this.showNoChangesMessage()&&(e=[{text:"There are no changes but you can deploy anyway if you wish.",code:"success"}]);var t;this.canDeploy()&&(t=React.createElement("div",{className:"section",onMouseEnter:this.mouseEnterHandler,onMouseLeave:this.mouseLeaveHandler},React.createElement("button",{value:"Confirm Deployment",className:"deploy pull-left",disabled:this.state.deploy_disabled,onClick:this.deployHandler},this.actionTitle()),React.createElement(c,{activated:this.state.deployHover,context:this.props.context,summary:this.props.summary})));var a=s.classNames({header:!0,inactive:!this.canDeploy(),loading:this.state.loading_changes});return React.createElement("div",null,React.createElement("div",{className:"section"},React.createElement("div",{className:a},React.createElement("span",{className:"status-icon"}),React.createElement("span",{className:"numberCircle"},"2")," Review changes"),React.createElement(i,{messages:e}),React.createElement(r,{changes:this.props.summary.changes})),t)}}),c=React.createClass({displayName:"QuickSummary",render:function(){var e="fast"===this.props.summary.actionCode?"code-only":"full",t=[];this.props.summary.estimatedTime&&this.props.summary.estimatedTime>0&&(t=[React.createElement("dt",null,"Duration:"),React.createElement("dd",null,this.props.summary.estimatedTime," min approx.")]);var a=s.classNames({activated:this.props.activated,"quick-summary":!0}),n=null;if("undefined"!=typeof this.props.context.deployHelp&&this.props.context.deployHelp&&(n=React.createElement("a",{target:"_blank",className:"small",href:this.props.context.deployHelp},"more info")),this.props.context.siteUrl)var r=React.createElement("a",{target:"_blank",href:this.props.context.siteUrl},this.props.context.envName);else var r=React.createElement("span",null,this.props.context.envName);return React.createElement("dl",{className:a},React.createElement("dt",null,"Environment:"),React.createElement("dd",null,r),React.createElement("dt",null,"Deploy type:"),React.createElement("dd",null,e," ",n),t)}}),i=React.createClass({displayName:"MessageList",render:function(){if(this.props.messages.length<1)return null;if("undefined"==typeof this.props.messages)return null;var e=0,t=this.props.messages.map(function(t){return e++,React.createElement(o,{key:e,message:t})});return React.createElement("div",null,t)}}),o=React.createClass({displayName:"Message",render:function(){var e={error:"alert alert-danger",warning:"alert alert-warning",success:"alert alert-info"},t=e[this.props.message.code];return React.createElement("div",{className:t,role:"alert",dangerouslySetInnerHTML:{__html:this.props.message.text}})}});t.exports=l},{"./events.js":3,"./helpers.js":4,"./summary_table.jsx":6}],2:[function(e,t,a){var n=e("./events.js"),s=e("./helpers.js"),r=e("./deploy_plan.jsx"),l=React.createClass({displayName:"DeploymentDialog",loadingSub:null,loadingDoneSub:null,errorSub:null,getInitialState:function(){return{loading:!1,loadingText:"",errorText:"",fetched:!0,last_fetched:""}},componentDidMount:function(){var e=this;this.loadingSub=n.subscribe("loading",function(t){e.setState({loading:!0,success:!1,loadingText:t})}),this.loadingDoneSub=n.subscribe("loading/done",function(){e.setState({loading:!1,loadingText:"",success:!0})}),this.errorSub=n.subscribe("error",function(t){e.setState({errorText:t,loading:!1,loadingText:"",success:!1})})},componentWillUnmount:function(){this.loadingSub.remove(),this.loadingDoneSub.remove(),this.errorSub.remove()},handleClick:function(e){e.preventDefault(),n.publish("loading","Fetching latest code…"),this.setState({fetched:!1});var t=this;Q($.ajax({type:"POST",dataType:"json",url:this.props.context.projectUrl+"/fetch"})).then(this.waitForFetchToComplete,this.fetchStatusError).then(function(){n.publish("loading/done"),t.setState({fetched:!0})})["catch"](this.fetchStatusError).done()},waitForFetchToComplete:function(e){var t=this;return this.getFetchStatus(e).then(function(a){return"Complete"===a.status?a:"Failed"===a.status?$.Deferred(function(e){return e.reject(a)}).promise():t.waitForFetchToComplete(e)})},getFetchStatus:function(e){return Q($.ajax({type:"GET",url:e.href,dataType:"json"}))},fetchStatusError:function(e){var t="Unknown error";"undefined"!=typeof e.responseText?t=e.responseText:"undefined"!=typeof e.message&&(t=e.message),n.publish("error",t)},lastFetchedHandler:function(e){this.setState({last_fetched:e})},render:function(){var e,t=s.classNames({"deploy-dropdown":!0,loading:this.state.loading,success:this.state.success});return""!==this.state.errorText?e=React.createElement(i,{message:this.state.errorText}):this.state.fetched?e=React.createElement(p,{context:this.props.context,data:this.props.data,lastFetchedHandler:this.lastFetchedHandler}):this.state.loading&&(e=React.createElement(c,{message:"Fetching latest code…"})),React.createElement("div",null,React.createElement("div",{className:t,onClick:this.handleClick},React.createElement("span",{className:"status-icon","aria-hidden":"true"}),React.createElement("span",{className:"time"},"last updated ",this.state.last_fetched),React.createElement(o,{environmentName:this.props.context.envName})),e)}}),c=React.createClass({displayName:"LoadingDeployForm",render:function(){return React.createElement("div",{className:"deploy-form-loading"},React.createElement("div",{className:"icon-holder"},React.createElement("i",{className:"fa fa-cog fa-spin"}),React.createElement("span",null,this.props.message)))}}),i=React.createClass({displayName:"ErrorMessages",render:function(){return React.createElement("div",{className:"deploy-dropdown-errors"},this.props.message)}}),o=React.createClass({displayName:"EnvironmentName",render:function(){return React.createElement("span",{className:"environment-name"},React.createElement("i",{className:"fa fa-rocket"}," "),"Deployment options ",React.createElement("span",{className:"hidden-xs"},"for ",this.props.environmentName))}}),p=React.createClass({displayName:"DeployForm",getInitialState:function(){return{selectedTab:1,data:[],preselectSha:null}},componentDidMount:function(){this.gitData()},gitData:function(){var e=this;e.setState({loading:!0}),Q($.ajax({type:"POST",dataType:"json",url:this.props.context.gitRevisionsUrl})).then(function(t){e.setState({loading:!1,data:t.Tabs,selectedTab:t.preselect_tab?parseInt(t.preselect_tab):1,preselectSha:t.preselect_sha}),e.props.lastFetchedHandler(t.last_fetched)},function(e){n.publish("error",e)})},selectHandler:function(e){this.setState({selectedTab:e})},render:function(){return this.state.loading?React.createElement(c,{message:"Loading…"}):React.createElement("div",{className:"deploy-form-outer clearfix"},React.createElement("form",{className:"form-inline deploy-form",action:"POST",action:"#"},React.createElement(d,{data:this.state.data,onSelect:this.selectHandler,selectedTab:this.state.selectedTab}),React.createElement(h,{context:this.props.context,data:this.state.data,selectedTab:this.state.selectedTab,preselectSha:this.state.preselectSha,SecurityToken:this.state.SecurityToken})))}}),d=React.createClass({displayName:"DeployTabSelector",render:function(){var e=this,t=this.props.data.map(function(t){return React.createElement(u,{key:t.id,tab:t,onSelect:e.props.onSelect,selectedTab:e.props.selectedTab})});return React.createElement("ul",{className:"SelectionGroup tabbedselectiongroup nolabel"},t)}}),u=React.createClass({displayName:"DeployTabSelect",handleClick:function(e){e.preventDefault(),this.props.onSelect(this.props.tab.id)},render:function(){var e=s.classNames({active:this.props.selectedTab==this.props.tab.id});return React.createElement("li",{className:e},React.createElement("a",{onClick:this.handleClick,href:"#deploy-tab-"+this.props.tab.id},this.props.tab.name))}}),h=React.createClass({displayName:"DeployTabs",render:function(){var e=this,t=this.props.data.map(function(t){return React.createElement(m,{context:e.props.context,key:t.id,tab:t,selectedTab:e.props.selectedTab,preselectSha:e.props.selectedTab==t.id?e.props.preselectSha:null,SecurityToken:e.props.SecurityToken})});return React.createElement("div",{className:"tab-content"},t)}}),m=React.createClass({displayName:"DeployTab",getInitialState:function(){return{summary:this.getInitialSummaryState(),options:{},sha:this.props.preselectSha?this.props.preselectSha:""}},getInitialSummaryState:function(){return{changes:{},messages:[],validationCode:"",estimatedTime:null,actionCode:null,initialState:!0}},componentDidMount:function(){this.shaChosen()&&this.changeSha(this.state.sha)},OptionChangeHandler:function(e){var t=this.state.options;t[e.target.name]=e.target.checked,this.setState({options:t})},SHAChangeHandler:function(e){this.setState({sha:e.target.value})},changeSha:function(e){this.setState({summary:this.getInitialSummaryState()}),n.publish("change_loading");var t=null;for(var a in this.props.tab.field_data)this.props.tab.field_data[a].id===e&&(t=this.props.tab.field_data[a].branch_name);var s={sha:e,branch:t,SecurityID:this.props.SecurityToken};for(var r in this.state.options)this.state.options.hasOwnProperty(r)&&(s[r]=this.state.options[r]);Q($.ajax({type:"POST",dataType:"json",url:this.props.context.envUrl+"/deploy_summary",data:s})).then(function(e){this.setState({summary:e}),n.publish("change_loading/done")}.bind(this),function(){n.publish("change_loading/done")})},changeHandler:function(e){if(e.preventDefault(),""!==e.target.value){var t=React.findDOMNode(this.refs.sha_selector.refs.sha).value;return this.changeSha(t)}},showOptions:function(){return"true"===this.props.tab.advanced_opts},showVerifyButton:function(){return this.showOptions()?!0:"textfield"==this.props.tab.field_type},shaChosen:function(){return""!==this.state.sha},render:function(){var e,t=s.classNames({"tab-pane":!0,clearfix:!0,active:this.props.selectedTab==this.props.tab.id});if("dropdown"==this.props.tab.field_type){var a=this.changeHandler;this.showVerifyButton()&&(a=this.SHAChangeHandler),e=React.createElement(f,{ref:"sha_selector",tab:this.props.tab,changeHandler:a,defaultValue:this.state.sha})}else"textfield"==this.props.tab.field_type&&(e=React.createElement(y,{ref:"sha_selector",tab:this.props.tab,changeHandler:this.SHAChangeHandler,defaultValue:this.state.sha}));var n=null;this.showOptions()&&(n=React.createElement(b,{tab:this.props.tab,changeHandler:this.OptionChangeHandler}));var l=null;return this.showVerifyButton()&&(l=React.createElement(g,{disabled:!this.shaChosen(),changeHandler:this.changeHandler})),React.createElement("div",{id:"deploy-tab-"+this.props.tab.id,className:t},React.createElement("div",{className:"section"},React.createElement("div",{htmlFor:this.props.tab.field_id,className:"header"},React.createElement("span",{className:"numberCircle"},"1")," ",this.props.tab.field_label),e,n,l),React.createElement(r,{context:this.props.context,summary:this.state.summary}))}}),f=React.createClass({displayName:"SelectorDropdown",componentDidMount:function(){$(React.findDOMNode(this.refs.sha)).select2({data:this.props.tab.field_data}).val(this.props.defaultValue),this.props.changeHandler&&$(React.findDOMNode(this.refs.sha)).select2().on("change",this.props.changeHandler)},render:function(){var e={width:"100%"};return React.createElement("div",null,React.createElement("div",{className:"field"},React.createElement("select",{ref:"sha",id:this.props.tab.field_id,name:"sha",className:"dropdown",onChange:this.props.changeHandler,style:e},React.createElement("option",{value:""},"Select ",this.props.tab.field_id))))}}),y=React.createClass({displayName:"SelectorText",render:function(){return React.createElement("div",{className:"field"},React.createElement("input",{type:"text",ref:"sha",id:this.props.tab.field_id,name:"sha",className:"text",defaultValue:this.props.defaultValue,onChange:this.props.changeHandler}))}}),g=React.createClass({displayName:"VerifyButton",render:function(){return React.createElement("div",{className:""},React.createElement("button",{disabled:this.props.disabled,value:"Verify deployment",className:"btn btn-default",onClick:this.props.changeHandler},"Verify deployment"))}}),b=React.createClass({displayName:"AdvancedOptions",render:function(){return React.createElement("div",{className:"deploy-options"},React.createElement("div",{className:"fieldcheckbox"},React.createElement("label",null,React.createElement("input",{type:"checkbox",name:"force_full",onChange:this.props.changeHandler}),"Force full deployment")),React.createElement("div",{className:"fieldcheckbox"},React.createElement("label",null,React.createElement("input",{type:"checkbox",name:"norollback",onChange:this.props.changeHandler}),"No rollback on deploy failure")))}});t.exports=l},{"./deploy_plan.jsx":1,"./events.js":3,"./helpers.js":4}],3:[function(e,t,a){var n={},s=n.hasOwnProperty;t.exports={subscribe:function(e,t){s.call(n,e)||(n[e]=[]);var a=n[e].push(t)-1;return{remove:function(){delete n[e][a]}}},publish:function(e,t){s.call(n,e)&&n[e].forEach(function(e){e(void 0!=t?t:{})})}}},{}],4:[function(e,t,a){t.exports={classNames:function(){for(var e="",t=0;t<arguments.length;t++){var a=arguments[t];if(a){var n=typeof a;if("string"===n||"number"===n)e+=" "+a;else if(Array.isArray(a))e+=" "+classNames.apply(null,a);else if("object"===n)for(var s in a)a.hasOwnProperty(s)&&a[s]&&(e+=" "+s)}}return e.substr(1)}}},{}],5:[function(e,t,a){var n=e("./deployment_dialog.jsx"),s=document.getElementById("deployment-dialog-holder");s&&React.render(React.createElement(n,{context:environmentConfigContext}),s)},{"./deployment_dialog.jsx":2}],6:[function(e,t,a){var n=React.createClass({displayName:"SummaryTable",isEmpty:function(e){for(var t in e)if(e.hasOwnProperty(t)&&e[t])return!1;return!0},render:function(){var e=this.props.changes;if(this.isEmpty(e))return null;var t=0,a=Object.keys(e).map(function(a){t++;var n=null;return"undefined"!=typeof e[a].compareUrl&&(n=e[a].compareUrl),"undefined"!=typeof e[a].description?""!==e[a].description?React.createElement(l,{key:t,name:a,description:e[a].description,compareUrl:n}):React.createElement(r,{key:t,name:a,value:""}):e[a].from!=e[a].to?React.createElement(s,{key:t,name:a,from:e[a].from,to:e[a].to,compareUrl:n}):React.createElement(r,{key:t,name:a,value:e[a].from})});return React.createElement("table",{className:"table table-striped table-hover"},React.createElement("tbody",null,a))}}),s=React.createClass({displayName:"SummaryLine",render:function(){var e=this.props.from,t=this.props.to;null!==e&&40===e.length&&(e=e.substring(0,7)),null!==t&&40===t.length&&(t=t.substring(0,7));var a=null;return null!==this.props.compareUrl&&(a=React.createElement("a",{target:"_blank",href:this.props.compareUrl},"View diff")),React.createElement("tr",null,React.createElement("th",{scope:"row"},this.props.name),React.createElement("td",null,e),React.createElement("td",null,React.createElement("span",{className:"glyphicon glyphicon-arrow-right"})),React.createElement("td",null,t),React.createElement("td",{className:"changeAction"},a))}}),r=React.createClass({displayName:"UnchangedSummaryLine",render:function(){var e=this.props.value;return null!==e&&40===e.length&&(e=e.substring(0,7)),React.createElement("tr",null,React.createElement("th",{scope:"row"},this.props.name),React.createElement("td",null,e),React.createElement("td",null," "),React.createElement("td",null,React.createElement("span",{className:"label label-success"},"Unchanged")),React.createElement("td",null," "))}}),l=React.createClass({displayName:"DescriptionOnlySummaryLine",render:function(){var e=null,t="4";return null!==this.props.compareUrl&&(e=React.createElement("td",{className:"changeAction"},React.createElement("a",{target:"_blank",href:this.props.compareUrl},"View diff")),t="3"),React.createElement("tr",null,React.createElement("th",{scope:"row"},this.props.name),React.createElement("td",{colSpan:t,dangerouslySetInnerHTML:{__html:this.props.description}}),e)}});t.exports=n},{}]},{},[5]);