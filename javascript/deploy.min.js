var events=function(){var e=function(){var e={},t=e.hasOwnProperty;return{subscribe:function(a,n){t.call(e,a)||(e[a]=[]);var s=e[a].push(n)-1;return{remove:function(){delete e[a][s]}}},publish:function(a,n){t.call(e,a)&&e[a].forEach(function(e){e(void 0!=n?n:{})})}}}();return e}(),classNames=function(){function e(){for(var t="",a=0;a<arguments.length;a++){var n=arguments[a];if(n){var s=typeof n;if("string"===s||"number"===s)t+=" "+n;else if(Array.isArray(n))t+=" "+e.apply(null,n);else if("object"===s)for(var r in n)n.hasOwnProperty(r)&&n[r]&&(t+=" "+r)}}return t.substr(1)}return e}(),TableFilter=function(e){function t(t){n=t.target;var s=document.getElementsByClassName(n.getAttribute("data-table"));e.forEach.call(s,function(t){e.forEach.call(t.tBodies,function(t){e.forEach.call(t.rows,a)})})}function a(e){var t=e.textContent.toLowerCase(),a=n.value.toLowerCase();e.style.display=-1===t.indexOf(a)?"none":"table-row"}var n;return{init:function(a){var n=document.getElementsByClassName(a);e.forEach.call(n,function(e){e.oninput=t})}}}(Array.prototype),deploy=function(e,t){var a=React.createClass({displayName:"DeployDropDown",loadingSub:null,loadingDoneSub:null,errorSub:null,getInitialState:function(){return{loading:!1,loadingText:"",errorText:"",fetched:!0,last_fetched:""}},componentDidMount:function(){var t=this;this.loadingSub=e.subscribe("loading",function(e){t.setState({loading:!0,success:!1,loadingText:e})}),this.loadingDoneSub=e.subscribe("loading/done",function(){t.setState({loading:!1,loadingText:"",success:!0})}),this.errorSub=e.subscribe("error",function(e){t.setState({errorText:e,loading:!1,loadingText:"",success:!1})})},componentWillUnmount:function(){this.loadingSub.remove(),this.loadingDoneSub.remove(),this.errorSub.remove()},handleClick:function(t){t.preventDefault(),e.publish("loading","Fetching latest code…"),this.setState({fetched:!1});var a=this;Q($.ajax({type:"POST",dataType:"json",url:this.props.context.projectUrl+"/fetch"})).then(this.waitForFetchToComplete,this.fetchStatusError).then(function(){e.publish("loading/done"),a.setState({fetched:!0})})["catch"](this.fetchStatusError).done()},waitForFetchToComplete:function(e){var t=this;return this.getFetchStatus(e).then(function(a){return"Complete"===a.status?a:"Failed"===a.status?$.Deferred(function(e){return e.reject(a)}).promise():t.waitForFetchToComplete(e)})},getFetchStatus:function(e){return Q($.ajax({type:"GET",url:e.href,dataType:"json"}))},fetchStatusError:function(t){var a="Unknown error";"undefined"!=typeof t.responseText?a=t.responseText:"undefined"!=typeof t.message&&(a=t.message),e.publish("error",a)},lastFetchedHandler:function(e){this.setState({last_fetched:e})},render:function(){var e,a=t({"deploy-dropdown":!0,loading:this.state.loading,success:this.state.success});return""!==this.state.errorText?e=React.createElement(s,{message:this.state.errorText}):this.state.fetched?e=React.createElement(l,{context:this.props.context,data:this.props.data,lastFetchedHandler:this.lastFetchedHandler}):this.state.loading&&(e=React.createElement(n,{message:"Fetching latest code…"})),React.createElement("div",null,React.createElement("div",{className:a,onClick:this.handleClick},React.createElement("span",{className:"status-icon","aria-hidden":"true"}),React.createElement("span",{className:"time"},"last updated ",this.state.last_fetched),React.createElement(r,{environmentName:this.props.context.envName})),e)}}),n=React.createClass({displayName:"LoadingDeployForm",render:function(){return React.createElement("div",{className:"deploy-form-loading"},React.createElement("div",{className:"icon-holder"},React.createElement("i",{className:"fa fa-cog fa-spin"}),React.createElement("span",null,this.props.message)))}}),s=React.createClass({displayName:"ErrorMessages",render:function(){return React.createElement("div",{className:"deploy-dropdown-errors"},this.props.message)}}),r=React.createClass({displayName:"EnvironmentName",render:function(){return React.createElement("span",{className:"environment-name"},React.createElement("i",{className:"fa fa-rocket"}," "),"Deployment options ",React.createElement("span",{className:"hidden-xs"},"for ",this.props.environmentName))}}),l=React.createClass({displayName:"DeployForm",getInitialState:function(){return{selectedTab:1,data:[]}},componentDidMount:function(){this.gitData()},gitData:function(){var t=this;t.setState({loading:!0}),Q($.ajax({type:"POST",dataType:"json",url:this.props.context.envUrl+"/git_revisions"})).then(function(e){t.setState({loading:!1,data:e.Tabs}),t.props.lastFetchedHandler(e.last_fetched)},function(t){e.publish("error",t)})},selectHandler:function(e){this.setState({selectedTab:e})},render:function(){return this.state.loading?React.createElement(n,{message:"Loading…"}):React.createElement("div",{className:"deploy-form-outer clearfix"},React.createElement("form",{className:"form-inline deploy-form",action:"POST",action:"#"},React.createElement(c,{data:this.state.data,onSelect:this.selectHandler,selectedTab:this.state.selectedTab}),React.createElement(o,{context:this.props.context,data:this.state.data,selectedTab:this.state.selectedTab,SecurityToken:this.state.SecurityToken})))}}),c=React.createClass({displayName:"DeployTabSelector",render:function(){var e=this,t=this.props.data.map(function(t){return React.createElement(i,{key:t.id,tab:t,onSelect:e.props.onSelect,selectedTab:e.props.selectedTab})});return React.createElement("ul",{className:"SelectionGroup tabbedselectiongroup nolabel"},t)}}),i=React.createClass({displayName:"DeployTabSelect",handleClick:function(e){e.preventDefault(),this.props.onSelect(this.props.tab.id)},render:function(){var e=t({active:this.props.selectedTab==this.props.tab.id});return React.createElement("li",{className:e},React.createElement("a",{onClick:this.handleClick,href:"#deploy-tab-"+this.props.tab.id},this.props.tab.name))}}),o=React.createClass({displayName:"DeployTabs",render:function(){var e=this,t=this.props.data.map(function(t){return React.createElement(d,{context:e.props.context,key:t.id,tab:t,selectedTab:e.props.selectedTab,SecurityToken:e.props.SecurityToken})});return React.createElement("div",{className:"tab-content"},t)}}),d=React.createClass({displayName:"DeployTab",getInitialState:function(){return{summary:this.getInitialSummaryState(),options:{},sha:""}},getInitialSummaryState:function(){return{changes:{},messages:[],validationCode:"",estimatedTime:null,actionCode:null,initialState:!0}},OptionChangeHandler:function(e){var t=this.state.options;t[e.target.name]=e.target.checked,this.setState({options:t})},SHAChangeHandler:function(e){this.setState({sha:e.target.value})},changeHandler:function(t){if(t.preventDefault(),this.setState({summary:this.getInitialSummaryState()}),""!==t.target.value){e.publish("change_loading");var a={sha:React.findDOMNode(this.refs.sha_selector.refs.sha).value,SecurityID:this.props.SecurityToken};for(var n in this.state.options)this.state.options.hasOwnProperty(n)&&(a[n]=this.state.options[n]);Q($.ajax({type:"POST",dataType:"json",url:this.props.context.envUrl+"/deploy_summary",data:a})).then(function(t){this.setState({summary:t}),e.publish("change_loading/done")}.bind(this),function(){e.publish("change_loading/done")})}},showOptions:function(){return"true"===this.props.tab.advanced_opts},showVerifyButton:function(){return this.showOptions()?!0:"textfield"==this.props.tab.field_type},shaChosen:function(){return""!==this.state.sha},render:function(){var e,a=t({"tab-pane":!0,clearfix:!0,active:this.props.selectedTab==this.props.tab.id});if("dropdown"==this.props.tab.field_type){var n=this.changeHandler;this.showVerifyButton()&&(n=this.SHAChangeHandler),e=React.createElement(p,{ref:"sha_selector",tab:this.props.tab,changeHandler:n})}else"textfield"==this.props.tab.field_type&&(e=React.createElement(u,{ref:"sha_selector",tab:this.props.tab,changeHandler:this.SHAChangeHandler}));var s=null;this.showOptions()&&(s=React.createElement(h,{tab:this.props.tab,changeHandler:this.OptionChangeHandler}));var r=null;return this.showVerifyButton()&&(r=React.createElement(m,{disabled:!this.shaChosen(),changeHandler:this.changeHandler})),React.createElement("div",{id:"deploy-tab-"+this.props.tab.id,className:a},React.createElement("div",{className:"section"},React.createElement("div",{htmlFor:this.props.tab.field_id,className:"header"},React.createElement("span",{className:"numberCircle"},"1")," ",this.props.tab.field_label),e,s,r),React.createElement(f,{context:this.props.context,summary:this.state.summary}))}}),p=React.createClass({displayName:"SelectorDropdown",componentDidMount:function(){$(React.findDOMNode(this.refs.sha)).select2({data:this.props.tab.field_data}),this.props.changeHandler&&$(React.findDOMNode(this.refs.sha)).select2().on("change",this.props.changeHandler)},render:function(){var e={width:"100%"};return React.createElement("div",null,React.createElement("div",{className:"field"},React.createElement("select",{ref:"sha",id:this.props.tab.field_id,name:"sha",className:"dropdown",onChange:this.props.changeHandler,style:e},React.createElement("option",{value:""},"Select ",this.props.tab.field_id))))}}),u=React.createClass({displayName:"SelectorText",render:function(){return React.createElement("div",{className:"field"},React.createElement("input",{type:"text",ref:"sha",id:this.props.tab.field_id,name:"sha",className:"text",onChange:this.props.changeHandler}))}}),m=React.createClass({displayName:"VerifyButton",render:function(){return React.createElement("div",{className:""},React.createElement("button",{disabled:this.props.disabled,value:"Verify deployment",className:"btn btn-default",onClick:this.props.changeHandler},"Verify deployment"))}}),h=React.createClass({displayName:"AdvancedOptions",render:function(){return React.createElement("div",{className:"deploy-options"},React.createElement("div",{className:"fieldcheckbox"},React.createElement("label",null,React.createElement("input",{type:"checkbox",name:"force_full",onChange:this.props.changeHandler}),"Force full deployment")))}}),f=React.createClass({displayName:"DeployPlan",loadingSub:null,loadingDoneSub:null,getInitialState:function(){return{loading_changes:!1,deploy_disabled:!1,deployHover:!1}},componentDidMount:function(){var t=this;this.loadingSub=e.subscribe("change_loading",function(){t.setState({loading_changes:!0})}),this.loadingDoneSub=e.subscribe("change_loading/done",function(){t.setState({loading_changes:!1})})},deployHandler:function(e){e.preventDefault(),this.setState({deploy_disabled:!0}),Q($.ajax({type:"POST",dataType:"json",url:this.props.context.envUrl+"/start-deploy",data:{strategy:this.props.summary,SecurityID:this.props.summary.SecurityID}})).then(function(e){window.location=e.url},function(e){console.error(e)})},mouseEnterHandler:function(e){this.setState({deployHover:!0})},mouseLeaveHandler:function(e){this.setState({deployHover:!1})},canDeploy:function(){return"success"===this.props.summary.validationCode||"warning"===this.props.summary.validationCode},isEmpty:function(e){for(var t in e)if(e.hasOwnProperty(t)&&e[t])return!1;return!0},showNoChangesMessage:function(){var e=this.props.summary;return e.initialState===!0?!1:"undefined"===e.messages?!0:this.isEmpty(e.changes)&&0===e.messages.length},actionTitle:function(){var e=this.props.summary.actionTitle;return"undefined"==typeof e||""===e?"Make a selection":this.props.summary.actionTitle},render:function(){var e=this.props.summary.messages;this.showNoChangesMessage()&&(e=[{text:"There are no changes but you can deploy anyway if you wish.",code:"success"}]);var a;this.canDeploy()&&(a=React.createElement("div",{className:"section",onMouseEnter:this.mouseEnterHandler,onMouseLeave:this.mouseLeaveHandler},React.createElement("button",{value:"Confirm Deployment",className:"deploy pull-left",disabled:this.state.deploy_disabled,onClick:this.deployHandler},this.actionTitle()),React.createElement(y,{activated:this.state.deployHover,context:this.props.context,summary:this.props.summary})));var n=t({header:!0,inactive:!this.canDeploy(),loading:this.state.loading_changes});return React.createElement("div",null,React.createElement("div",{className:"section"},React.createElement("div",{className:n},React.createElement("span",{className:"status-icon"}),React.createElement("span",{className:"numberCircle"},"2")," Review changes"),React.createElement(g,{messages:e}),React.createElement(v,{changes:this.props.summary.changes})),a)}}),y=React.createClass({displayName:"QuickSummary",render:function(){var e="fast"===this.props.summary.actionCode?"code-only":"full",a=[];this.props.summary.estimatedTime&&this.props.summary.estimatedTime>0&&(a=[React.createElement("dt",null,"Duration:"),React.createElement("dd",null,this.props.summary.estimatedTime," min approx.")]);var n=t({activated:this.props.activated,"quick-summary":!0}),s=null;if("undefined"!=typeof this.props.context.deployHelp&&this.props.context.deployHelp&&(s=React.createElement("a",{target:"_blank",className:"small",href:this.props.context.deployHelp},"more info")),this.props.context.siteUrl)var r=React.createElement("a",{target:"_blank",href:this.props.context.siteUrl},this.props.context.envName);else var r=React.createElement("span",null,this.props.context.envName);return React.createElement("dl",{className:n},React.createElement("dt",null,"Environment:"),React.createElement("dd",null,r),React.createElement("dt",null,"Deploy type:"),React.createElement("dd",null,e," ",s),a)}}),g=React.createClass({displayName:"MessageList",render:function(){if(this.props.messages.length<1)return null;if("undefined"==typeof this.props.messages)return null;var e=0,t=this.props.messages.map(function(t){return e++,React.createElement(R,{key:e,message:t})});return React.createElement("div",null,t)}}),R=React.createClass({displayName:"Message",render:function(){var e={error:"alert alert-danger",warning:"alert alert-warning",success:"alert alert-info"},t=e[this.props.message.code];return React.createElement("div",{className:t,role:"alert",dangerouslySetInnerHTML:{__html:this.props.message.text}})}}),v=React.createClass({displayName:"SummaryTable",isEmpty:function(e){for(var t in e)if(e.hasOwnProperty(t)&&e[t])return!1;return!0},render:function(){var e=this.props.changes;if(this.isEmpty(e))return null;var t=0,a=Object.keys(e).map(function(a){t++;var n=null;return"undefined"!=typeof e[a].compareUrl&&(n=e[a].compareUrl),"undefined"!=typeof e[a].description?""!==e[a].description?React.createElement(S,{key:t,name:a,description:e[a].description}):React.createElement(b,{key:t,name:a,value:""}):e[a].from!=e[a].to?React.createElement(E,{key:t,name:a,from:e[a].from,to:e[a].to,compareUrl:n}):React.createElement(b,{key:t,name:a,value:e[a].from})});return React.createElement("table",{className:"table table-striped table-hover"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null," "),React.createElement("th",null," "),React.createElement("th",{className:"transitionIcon"}," "),React.createElement("th",null," "),React.createElement("th",{className:"changeAction"}," "))),React.createElement("tbody",null,a))}}),E=React.createClass({displayName:"SummaryLine",render:function(){var e=this.props.from,t=this.props.to;null!==e&&40===e.length&&(e=e.substring(0,7)),null!==t&&40===t.length&&(t=t.substring(0,7));var a=null;return null!==this.props.compareUrl&&(a=React.createElement("a",{target:"_blank",href:this.props.compareUrl},"View diff")),React.createElement("tr",null,React.createElement("th",{scope:"row"},this.props.name),React.createElement("td",null,e),React.createElement("td",null,React.createElement("span",{className:"glyphicon glyphicon-arrow-right"})),React.createElement("td",null,t),React.createElement("td",{className:"changeAction"},a))}}),b=React.createClass({displayName:"UnchangedSummaryLine",render:function(){var e=this.props.value;return null!==e&&40===e.length&&(e=e.substring(0,7)),React.createElement("tr",null,React.createElement("th",{scope:"row"},this.props.name),React.createElement("td",null,e),React.createElement("td",null," "),React.createElement("td",null,React.createElement("span",{className:"label label-success"},"Unchanged")),React.createElement("td",null," "))}}),S=React.createClass({displayName:"DescriptionOnlySummaryLine",render:function(){return React.createElement("tr",null,React.createElement("th",{scope:"row"},this.props.name),React.createElement("td",{colSpan:"4",dangerouslySetInnerHTML:{__html:this.props.description}}))}});return{render:function(e){React.render(React.createElement(a,{context:e}),document.getElementById("deploy_form"))}}}(events,classNames);"undefined"!=typeof context&&deploy.render(context);
//# sourceMappingURL=deploy.min.js.map